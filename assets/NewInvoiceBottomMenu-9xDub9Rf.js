import{g as P,aM as V,Q as R,aN as T,b as M,j as v}from"./index-BGXO2lPp.js";import{c as g,g as E,e as B,P as D}from"./InvoiceStatus-BYFB8oeg.js";import{C as H}from"./CancelButton-DCVx1bk1.js";import{b as x,M as L,S as Q,a as W,c as _}from"./defaultValues-DzdHoEjO.js";import{u as j,e as $,c as z}from"./SlidingMenu-CJAihzrY.js";import{a as O,v as q}from"./utilityFunctions-BAfcw2Vo.js";import{u as G}from"./useMutation-DS9AGViE.js";import"./editPageStyles-SK7J9V0i.js";import"./create-visual-element-D1gbSJ56.js";const N=()=>{const{setSelectedPaymentOption:s,setIsNewInvoiceOpen:a,methods:t}=g(),r=j("cachedNewInvoiceForm"),{reset:n,clearErrors:c}=t;return()=>{r.clearCache(),s(1),n(x),c(),a(!1)}},k=()=>{const[s]=G(V,{refetchQueries:[{query:P}],onError:t=>{console.error(t)}});return{handleAddInvoice:async t=>{try{await s({variables:{...t}})}catch(r){console.error(r)}}}},J=()=>{const{startDate:s,selectedPaymentOption:a,methods:t,setIsCacheActive:r}=g(),{trigger:n,reset:c,setError:u,clearErrors:d,getValues:p}=t,{replace:f}=E({name:"items"}),y=N(),{handleAddInvoice:I}=k();return async()=>{var w;await n();const e=t.formState.errors;if($(e).filter(o=>o!=="required").length>0){R.error("Please fix the errors before saving as draft",{position:"top-right",autoClose:2e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!1,progress:void 0,toastId:"save-draft-error-toast"}),z(e,"required"),c(void 0,{keepValues:!0});for(const o in e)(w=e[o])!=null&&w.type&&u(o,{type:e[o].type,message:e[o].message});e.items&&(Array.isArray(e.items)?e.items:Object.values(e.items)).forEach((b,F)=>{b&&typeof b=="object"&&Object.keys(b).forEach(A=>{const h=b[A];h!=null&&h.type&&u(`items[${F}].${A}`,{type:h.type,message:h.message})})});return}d();const C=p();C.items||(C.items=[{id:"",name:"",quantity:0,price:0,total:0}]);const S=O(C,s,a);S.status="draft";try{await I(S),r(!1),y(),f([{id:q(),name:"",quantity:0,price:0,total:0}])}catch(o){console.error(o)}}},K=()=>{const{setIsDraft:s,methods:a,startDate:t,selectedPaymentOption:r,setIsCacheActive:n}=g(),{trigger:c,setError:u,getValues:d}=a,{replace:p}=E({name:"items"}),f=N(),{handleAddInvoice:y}=k();return async m=>{if(T.flushSync(()=>s(!1)),m=d(),!m.items){u("items",{type:"custom",message:"An item must be added"});return}if(await c()){const i=O(m,t,r);i.items=i.items.map(l=>({...l,quantity:Number(l.quantity),price:Number(l.price)})),i.status="pending";try{await y(i),n(!1),f(),p([{id:q(),name:"",quantity:0,price:0,total:0}])}catch(l){console.error(l)}}}};function U({closeText:s,justifyCancel:a}){const{clearErrors:t,handleSubmit:r}=B(),{setIsNewInvoiceOpen:n,setStartDate:c,setSelectedPaymentOption:u,setIsCacheActive:d,methods:p}=g(),{reset:f}=p,y=K(),I=J(),{clearCache:m}=j("cachedNewInvoiceForm"),e=()=>{d(!1),m(),t(),n(!1),f(x),c(new Date),u(1)},i=M();return v.jsxs(L,{children:[v.jsx(H,{handleClick:e,text:s,justifySelf:a||""}),v.jsxs(Q,{children:[v.jsx(W,{type:"button",value:i>325?"Save as draft":"Draft",onClick:()=>I()}),v.jsx(_,{type:"button",value:"Save",onClick:r(y)})]})]})}U.propTypes={closeText:D.string.isRequired,justifyCancel:D.string};export{U as default};
