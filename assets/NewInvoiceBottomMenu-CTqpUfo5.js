import{k as P,aN as V,Q as R,aO as T,f as M,j as I}from"./index-DPd1qPLZ.js";import{b as g,f as E,d as B,P as D}from"./InvoiceStatus-nCRc6NUy.js";import{C as H}from"./CancelButton-Qfq45QhE.js";import{b as x,M as L,S as Q,a as W,c as _}from"./defaultValues-DmTNWt_V.js";import{u as O,e as $,c as K}from"./SlidingMenu-BD3Ghkle.js";import{a as j,v as q}from"./utilityFunctions-CAPD2Jrd.js";import{u as z}from"./ReactToastify-CXwMS95O.js";import"./editPageStyles-C4V02GEE.js";import"./create-visual-element-D-S0tcFb.js";const N=()=>{const{setSelectedPaymentOption:s,setIsNewInvoiceOpen:a,methods:t}=g(),r=O("cachedNewInvoiceForm"),{reset:n,clearErrors:c}=t;return()=>{r.clearCache(),s(1),n(x),c(),a(!1)}},k=()=>{const[s]=z(V,{refetchQueries:[{query:P}],onError:t=>{console.error(t)}});return{handleAddInvoice:async t=>{try{await s({variables:{...t}})}catch(r){console.error(r)}}}},G=()=>{const{startDate:s,selectedPaymentOption:a,methods:t,setIsCacheActive:r}=g(),{trigger:n,reset:c,setError:u,clearErrors:f,getValues:p}=t,{replace:y}=E({name:"items"}),v=N(),{handleAddInvoice:b}=k();return async()=>{var w;await n();const e=t.formState.errors;if($(e).filter(d=>d!=="required").length>0){R.error("Please fix the errors before saving as draft",{position:"top-right",autoClose:2e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!1,progress:void 0,toastId:"save-draft-error-toast"}),K(e,"required"),c(void 0,{keepValues:!0});for(const d in e){const o=d;(w=e[o])!=null&&w.type&&u(o,{type:e[o].type,message:e[o].message})}e.items&&(Array.isArray(e.items)?e.items:Object.values(e.items)).forEach((o,F)=>{o&&typeof o=="object"&&Object.keys(o).forEach(A=>{const h=o[A];h!=null&&h.type&&u(`items[${F}].${A}`,{type:h.type,message:h.message})})});return}f();const C=p();C.items||(C.items=[{id:"",name:"",quantity:0,price:0,total:0}]);const S=j(C,s,a);S.status="draft";try{await b(S),r(!1),v(),y([{id:q(),name:"",quantity:0,price:0,total:0}])}catch(d){console.error(d)}}},J=()=>{const{setIsDraft:s,methods:a,startDate:t,selectedPaymentOption:r,setIsCacheActive:n}=g(),{trigger:c,setError:u,getValues:f}=a,{replace:p}=E({name:"items"}),y=N(),{handleAddInvoice:v}=k();return async m=>{if(T.flushSync(()=>s(!1)),m=f(),!m.items){u("items",{type:"custom",message:"An item must be added"});return}if(await c()){const i=j(m,t,r);i.items=i.items.map(l=>({...l,quantity:Number(l.quantity),price:Number(l.price)})),i.status="pending";try{await v(i),n(!1),y(),p([{id:q(),name:"",quantity:0,price:0,total:0}])}catch(l){console.error(l)}}}};function U({closeText:s,justifyCancel:a}){const{clearErrors:t,handleSubmit:r}=B(),{setIsNewInvoiceOpen:n,setStartDate:c,setSelectedPaymentOption:u,setIsCacheActive:f,methods:p}=g(),{reset:y}=p,v=J(),b=G(),{clearCache:m}=O("cachedNewInvoiceForm"),e=()=>{f(!1),m(),t(),n(!1),y(x),c(new Date),u(1)},i=M();return I.jsxs(L,{children:[I.jsx(H,{handleClick:e,text:s,justifySelf:a||""}),I.jsxs(Q,{children:[I.jsx(W,{"data-testid":"saveDraft",type:"button",value:i>325?"Save as draft":"Draft",onClick:()=>b()}),I.jsx(_,{type:"button",value:"Save",onClick:r(v)})]})]})}U.propTypes={closeText:D.string.isRequired,justifyCancel:D.string};export{U as default};
